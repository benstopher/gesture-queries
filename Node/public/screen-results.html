<!DOCTYPE html>
<html>
<head>
	<title>Skeleton Queries</title>
	<link rel="stylesheet" type="text/css" href="assets/stylesheets/style.css">
	<link rel="stylesheet" type="text/css" href="assets/stylesheets/svg-style.css">
	<style type="text/css">
		#frame{
			width: 1920px;
			padding: 20px 0 20px 20px;
			overflow-x: hidden;
		}
			#masonry-container{
				width:1900px;
				margin: 0;
				padding: 0;
				list-style-type: none;
			}
			.masonry-item{
				width: 360px;
				margin-bottom: 20px;
				position: relative;

			}
			.masonry-item.no-img .filler{
				background: #666666;
				width: 360px;
				height: 360px;
			}
				.masonry-item img{
					width: 100%;
					height: auto;
					display: block;
				}
				.masonry-item hgroup{
					position: absolute;
					width: 100%;
					top: 50%;
					left: 0;
					text-align: center;
					line-height: 1.2em;
					margin-top: -1.2em;
					padding: 0 20px;
					box-sizing: border-box;
				}
					.masonry-item hgroup h1{
						font-size: 2em;
						text-transform: uppercase;
						font-weight: normal;
					}
					.masonry-item hgroup h2{
						font-size: 0.7em;
						font-weight: 200;
					}

					.masonry-item span{
						position: absolute;
						bottom: 20px;
						display: block;
						width: 100%;
						text-align: center;
						padding: 0 20px;
						box-sizing: border-box;
					}
					.masonry-item span:before{
						content: "@ ";
					}
	</style>
</head>
<body>

	<div id="frame">
		<ul id="masonry-container">
			
		</ul>
	</div>

	<script src="assets/javascript/libs/zepto.js"></script>
	<script src="assets/javascript/libs/masonry.pkgd.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script src="assets/javascript/libs/leap-0.4.3.js"></script>
	<script src="assets/javascript/libs/d3.js"></script>
	<script src="assets/javascript/libs/_o.js"></script>
	<script src="assets/javascript/libs/_o.render.js"></script>
	<script src="assets/javascript/modules/help.js"></script>
	<script src="assets/javascript/modules/Timer.js"></script>
	<script src="assets/javascript/modules/GetBodies.js"></script>
	<script src="assets/javascript/modules/GetHands.js"></script>
	<script src="assets/javascript/modules/GetSpeech.js"></script>
	<script src="assets/javascript/modules/DataSaver.js"></script>
	<script src="assets/javascript/modules/Input.js"></script>
	<script src="assets/javascript/modules/d3/LineChart.js"></script>
	<script src="assets/javascript/modules/d3/StreamGraph.js"></script>
	<script src="assets/javascript/modules/d3/DonutChart.js"></script>
	<script src="assets/javascript/modules/d3/ForceNodeChart.js"></script>
	<script src="assets/javascript/modules/WaveformRenderer.js"></script>
	<script src="assets/javascript/modules/SoundVsSilence.js"></script>
	<script src="assets/javascript/modules/kimono/Kimono.js"></script>
	<script src="assets/javascript/modules/QueryMaker.js"></script>
	<script src="assets/javascript/scratch_data_conversions.js"></script>
	<script>
		var timer = new Timer();
		var msnry = new Masonry( '#masonry-container', {
			columnWidth: 380,
			itemSelector: '.masonry-item'
		});
		var lastQuery;
		var q = new QueryMaker();
		
		this.socket = io.connect( 'http://localhost/query-destination' );

		this.socket.on('query-data', function( data ){
			console.log( "DATA: ", data );
			if( data.length > 0 ){
				lastQuery = data;
				q.query( data );
			}
		});

		q.onResult = function( results ){
			console.log( "RESULTS: ", results );
			console.log( "LAST QUERY: ", lastQuery );
			var eles = [];
			for( var i = 0; i < results.length; i++ ){
				if( typeof results[i] !== 'undefined' ){
					for( var j = 0; j < results[i].length; j++ ){
						var termFromQuery = lastQuery.split(' ');
						var termFromQuery = termFromQuery[ Math.floor( Math.random() * termFromQuery.length ) ];
						var $item = $('<li class="masonry-item"></li>');
						var $header = $('<hgroup></hgroup>' );
						console.log( "TITLE: " + termFromQuery );
						var $title = $( '<h1>' + termFromQuery + '</h1>' );							
						var $timestamp = $('<span>' + timer.getTimestamp() + '</span>')
						
						$header.append( $title );
						if( results[ i ][ j ].title !== undefined ){	
							var $subtitle = $( '<h2>' + results[ i ][ j ].title.text + '</h2>' );
							$header.append( $subtitle );
						}
						$item.append( $header );
						$item.append( $timestamp );
						
						if( results[i][j].image.src != undefined ){
							var $img = $('<img src="' + results[ i ][ j ].image.src + '">');
							$item.append( $img );
						} else {
							$item.addClass( 'no-img' );
							$item.append( '<div class="filler"></div>' );
						}
						
						eles.push( $item[0] );
					}		
				}
			}
			$('#masonry-container').prepend( eles );
			msnry.prepended( eles );
		}
	</script>
</body>
</html>